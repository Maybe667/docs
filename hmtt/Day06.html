<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Day06_小思同学 | UIIO的笔记小站</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="UIIO的笔记小站">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.3cb233de.css" as="style"><link rel="preload" href="/assets/js/app.e0cc1cb1.js" as="script"><link rel="preload" href="/assets/js/3.9eb4373a.js" as="script"><link rel="preload" href="/assets/js/1.592f9f83.js" as="script"><link rel="preload" href="/assets/js/15.fd252bbc.js" as="script"><link rel="prefetch" href="/assets/js/10.df4741fb.js"><link rel="prefetch" href="/assets/js/11.741d00e8.js"><link rel="prefetch" href="/assets/js/12.b6cdf8f6.js"><link rel="prefetch" href="/assets/js/13.c374d746.js"><link rel="prefetch" href="/assets/js/14.aaf533bd.js"><link rel="prefetch" href="/assets/js/16.5a087e93.js"><link rel="prefetch" href="/assets/js/17.4edb9cc6.js"><link rel="prefetch" href="/assets/js/18.25d7b9eb.js"><link rel="prefetch" href="/assets/js/19.8e818515.js"><link rel="prefetch" href="/assets/js/4.fae9d412.js"><link rel="prefetch" href="/assets/js/5.edf2f673.js"><link rel="prefetch" href="/assets/js/6.08d7d481.js"><link rel="prefetch" href="/assets/js/7.80895dd6.js"><link rel="prefetch" href="/assets/js/8.94ae76c4.js"><link rel="prefetch" href="/assets/js/9.30f14a82.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3cb233de.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>UIIO的笔记小站</h3> <p class="description" data-v-59e6cb88>UIIO的笔记小站</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.jpg" alt="UIIO的笔记小站" class="logo"> <span class="site-name">UIIO的笔记小站</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      黑马头条(暂)
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hmtt/day00.html" class="nav-link"><i class="undefined"></i>
  Day00_开始
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day01.html" class="nav-link"><i class="undefined"></i>
  Day01_项目开始_登录
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day02.html" class="nav-link"><i class="undefined"></i>
  Day02_首页
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day03.html" class="nav-link"><i class="undefined"></i>
  Day03_反馈操作和频道管理
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day04.html" class="nav-link"><i class="undefined"></i>
  Day04_文章搜索和详情
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day05.html" class="nav-link"><i class="undefined"></i>
  Day05_文章评论-个人中心
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day06.html" class="nav-link"><i class="undefined"></i>
  Day06_小思同学
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day07.html" class="nav-link"><i class="undefined"></i>
  Day07_优化细节
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day08.html" class="nav-link"><i class="undefined"></i>
  Day08_知识扩展-打包部署
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Maybe667/docs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>9</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      黑马头条(暂)
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hmtt/day00.html" class="nav-link"><i class="undefined"></i>
  Day00_开始
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day01.html" class="nav-link"><i class="undefined"></i>
  Day01_项目开始_登录
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day02.html" class="nav-link"><i class="undefined"></i>
  Day02_首页
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day03.html" class="nav-link"><i class="undefined"></i>
  Day03_反馈操作和频道管理
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day04.html" class="nav-link"><i class="undefined"></i>
  Day04_文章搜索和详情
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day05.html" class="nav-link"><i class="undefined"></i>
  Day05_文章评论-个人中心
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day06.html" class="nav-link"><i class="undefined"></i>
  Day06_小思同学
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day07.html" class="nav-link"><i class="undefined"></i>
  Day07_优化细节
</a></li><li class="dropdown-item"><!----> <a href="/hmtt/day08.html" class="nav-link"><i class="undefined"></i>
  Day08_知识扩展-打包部署
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Maybe667/docs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Day06_小思同学</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2022
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Day06_小思同学</h1> <div data-v-8a445198><!----> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>11/17/2022</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="_1-http协议复习"><a href="#_1-http协议复习" class="header-anchor">#</a> 1.http协议复习</h2> <h3 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h3> <ul><li>什么是http协议</li> <li>什么是请求报文和响应报文</li></ul> <h3 id="讲解"><a href="#讲解" class="header-anchor">#</a> 讲解</h3> <ol><li><p>http中文意思:  超文本传输协议, 定义服务器和客户端的传送格式</p></li> <li><p>请求发送的数据包, 叫请求报文, 格式如下</p> <p><img src="images/image-20210705173805808.png" alt="image-20210705173805808"></p></li> <li><p>响应回来的数据包, 叫响应报文, 格式如下</p> <p><img src="images/image-20210705173837886.png" alt="image-20210705173837886"></p></li></ol> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <ul><li>HTTP 协议：客户端与服务器建立通信连接之后
<ul><li>服务器端只能<strong>被动地</strong>响应客户端的请求，==无法主动给客户端发送消息。== 一次请求才能对应一次响应</li></ul></li></ul> <p>http建议阅读: http://lidongxuwork.gitee.io/pages/computer/network/http%E5%8D%8F%E8%AE%AE.html#%E5%AD%97%E6%AE%B5%E6%80%BB%E7%BB%93</p> <p>http-mdn地址: https://developer.mozilla.org/zh-CN/docs/Web/HTTP</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <ol><li>http协议是规划端与端传输信息的格式</li> <li>http协议暂定一次请求对应一次响应</li></ol> <h2 id="_2-即时通信介绍"><a href="#_2-即时通信介绍" class="header-anchor">#</a> 2.即时通信介绍</h2> <h3 id="目标-2"><a href="#目标-2" class="header-anchor">#</a> 目标</h3> <ul><li>什么是即时通信</li> <li>ajax是否能实现</li> <li>即时通信实现技术</li></ul> <h3 id="讲解-2"><a href="#讲解-2" class="header-anchor">#</a> 讲解</h3> <ol><li><p>即时通信: 即时发送和接收互联网消息等的业务</p></li> <li><p>ajax只能是发起请求后, 得到一次响应, 无法实现即时通信</p> <blockquote><p>但是可模拟, 比如创建计时器, 每隔1秒, 自动调用一次接口, 拿到服务器要发送的数据</p> <p>但这非常可怕</p> <p>(1): 万一服务器上没有你要的最新消息, 这次请求和响应是无意义的</p> <p>(2): 服务器为了给你做出响应, 还占用了一定内存和带宽, 很浪费</p></blockquote> <p>以上技术叫计时器轮询, 迫不得已才能使用(一般用不上, 了解即可)</p></li> <li><p>HTML5出了一个新的技术叫WebSocket, 可以在一个TCP链接上, 实现即时通信效果</p> <ul><li>需要前端支持</li> <li>需要后端支持</li></ul></li></ol> <h3 id="使用场景"><a href="#使用场景" class="header-anchor">#</a> 使用场景</h3> <ul><li>直播
<ul><li>主播的实时画面数据, 推送到服务器上</li> <li>服务器主动推送视频流到所有客户端设备上(重点)</li></ul></li> <li>语音
<ul><li>说话人声音数据流推送到服务器上</li> <li>服务器推送给指定的客户端设备上(重点)</li></ul></li> <li>文字聊天
<ul><li>有一个人发送文字到服务器上</li> <li>服务器推送给指定/所有客户端(重点)</li> <li>体验下: http://123.57.109.30:4005/index2.html  (多开几个窗口自己跟自己聊)</li></ul></li></ul> <h3 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h3> <ol><li>什么是即时通信?
<ul><li>服务器能主动给客户端发送消息, 不局限于一次请求一次响应</li></ul></li> <li>ajax是否能实现即时通信?
<ul><li>只能模拟, 用轮询方式, 但是耗费资源, 少用</li></ul></li> <li>如何实现即时通信?
<ul><li>前端采用WebSocket协议, 也是新出的一个类</li> <li>后端也要提供WebSocket接口地址, 建立连接</li></ul></li></ol> <h2 id="_3-websocket使用"><a href="#_3-websocket使用" class="header-anchor">#</a> 3.webSocket使用</h2> <h3 id="目标-3"><a href="#目标-3" class="header-anchor">#</a> 目标</h3> <ul><li>自己用原生JS实现一次WebSocket使用</li> <li>前提: 一定需要一个后端服务器(支持socket的)</li></ul> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>它是一种新的技术, 前后端只要支持这种协议,  ==后端可以主动向前端推送内容==</p> <p>项目中使用: 做一个智能客服</p> <p>Websocket 通过HTTP/1.1 协议的101状态码进行握手</p> <p>其实VueCli脚手架服务器 和 浏览器之间就建立了一个WebSocket通道</p> <blockquote><p>才实现的代码一改, 服务器向浏览器主动推送更新的js文件, 页面就自动更新了</p></blockquote> <p>协议对比</p> <p><img src="images/image-20210705180913529.png" alt="image-20210705180913529"></p> <h3 id="体验-前端代码"><a href="#体验-前端代码" class="header-anchor">#</a> 体验 - 前端代码</h3> <p>代码直接复制体验即可</p> <blockquote><p>这里后台采用: wss://echo.websocket.org 这个地址实现socket连接</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>体验websocket<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">#contanier</span> <span class="token punctuation">{</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>
            <span class="token property">border</span><span class="token punctuation">:</span> 2px dashed #7575e7<span class="token punctuation">;</span>
            <span class="token property">overflow-y</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>contanier<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 1  建立连接 (拨号) --&gt;</span>
    <span class="token comment">&lt;!-- 2  发消息 接消息 --&gt;</span>
    <span class="token comment">&lt;!-- 3  关闭连接 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">openWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>建立连接<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>发送消息<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">closeWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>关闭连接<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
     
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;contanier&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> inputDom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> isOpen <span class="token operator">=</span> <span class="token boolean">false</span>  <span class="token comment">// 表示是否已经建立了拨号</span>
        <span class="token keyword">var</span> ws<span class="token punctuation">;</span>  <span class="token comment">// 别的方法 也需要使用ws</span>
           <span class="token comment">// 打开websocket连接</span>
          <span class="token keyword">var</span>  <span class="token function-variable function">openWS</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token comment">/// 网络上提供的一个测试websocket功能的服务器地址。</span>
              <span class="token comment">/// 它的效果是，你向服务器发什么消息 ，它就原样回复给你。</span>
              ws <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'wss://echo.websocket.org'</span><span class="token punctuation">)</span>  <span class="token comment">// 建立与服务器的连接</span>

              <span class="token comment">// onopen是webSocket约定事件名</span>
              <span class="token comment">// 当本地客户端浏览器与服务器建立连接之后，就会执行onopen的回调</span>
              ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isOpen <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token comment">// 建立成功</span>
                dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;与服务器成功建立连接&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
              <span class="token punctuation">}</span>
              <span class="token comment">//   接收消息</span>
              <span class="token comment">// onmessage是webSocket约定事件名</span>
              <span class="token comment">// 如果从服务器上发过来了消息，则会进入onmessage的回调</span>
              ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token comment">// 由于 我们先给服务器发了消息 服务器给我们回了消息</span>
                  dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p style='color: blue'&gt;服务器说:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
              <span class="token punctuation">}</span>
              <span class="token comment">// onclose是webSocket约定事件名</span>
              ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   <span class="token comment">// 此函数表示 关闭连接成功</span>
                   isOpen <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 把状态关闭掉</span>
                   dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;与服务器连接关闭&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token comment">//   发送消息 接收消息</span>
          <span class="token keyword">var</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>inputDom<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> isOpen<span class="token punctuation">)</span>   <span class="token punctuation">{</span>
             <span class="token comment">// 发消息 要等到 连接成功才能发 而且内容不为空</span>

             <span class="token comment">// 发消息就是send</span>
             ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>inputDom<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 发送消息</span>
            <span class="token comment">//   发完之后 添加到 当前视图上</span>
             dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerHTML <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p style='color: red'&gt;我说:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>inputDom<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span>
             inputDom<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token punctuation">}</span>

          <span class="token punctuation">}</span>
          <span class="token comment">// 关闭连接</span>
          <span class="token keyword">var</span>  <span class="token function-variable function">closeWS</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 关闭连接</span>
          <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="小结-3"><a href="#小结-3" class="header-anchor">#</a> 小结</h3> <ol><li>vuecli脚手架启动的webpack开发服务器, 和浏览器之间也建立着一条socket通道</li> <li>WebSocket还是基于TCP, 但是会隔几秒发一个很小的包给后台(心跳包) 维持这段连接</li></ol> <h2 id="_4-socket-io包使用"><a href="#_4-socket-io包使用" class="header-anchor">#</a> 4.socket.io包使用</h2> <blockquote><p>前端对WebSocket封装很好</p> <p>后端对socket代码也封装好了</p></blockquote> <h3 id="目标-4"><a href="#目标-4" class="header-anchor">#</a> 目标</h3> <ul><li>后端socket支持
<ul><li>nodejs的Express建立web服务器</li> <li>nodejs集成socket.io包开启后端socket服务</li></ul></li> <li>前端也要使用socket.io包使用socket服务</li> <li>英文文档: https://socket.io/docs/v4/client-initialization/</li> <li>中文文档: https://www.w3cschool.cn/socket/socket-k49j2eia.html</li></ul> <h3 id="后端代码"><a href="#后端代码" class="header-anchor">#</a> 后端代码</h3> <p>server.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4005</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// io.on('connection') -- 固定的, 用于 监测有没有人用socket服务链接我, 触发后面的函数</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// socket连接者对象</span>
  <span class="token comment">// console.log('a user connected');</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'cTos'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 谁来链接我, 我就给谁绑定一个事件叫cTos(随便), data接收的就是前端触发这个事件传递过来的聊天消息</span>

    <span class="token comment">// io.sockets(拿到当前连接池里所有的socket对象-链接到我的所有人), emit()触发事件(前端事件叫sToC) ---- 广播</span>
      io<span class="token punctuation">.</span>sockets<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'sToC'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment">// 把当前收到的聊天消息, 发送给所有连接着(前端)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="前端代码"><a href="#前端代码" class="header-anchor">#</a> 前端代码</h3> <p>index.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 1. 引入前端的socket.io注意版本 一定要跟后台对上 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/socket.io@4.1.2/client-dist/socket.io.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>聊天窗口:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>result<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>消息<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">// 2. 用io()函数链接socket服务器</span>
        <span class="token comment">// 如果代码部署到了线上服务器, 这个localhost要换成线上的ip地址</span>
        <span class="token comment">// 因为这个网页请求到本地浏览器上查看, 你要还是localhost那不是请求本地呢吗?</span>
        <span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">&quot;ws://localhost:4005&quot;</span><span class="token punctuation">)</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#btn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 3. socket触发后端的事件</span>
            socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'cTos'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> user<span class="token punctuation">,</span> msg <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'sToC'</span><span class="token punctuation">,</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;p&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token punctuation">.</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 说: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj<span class="token punctuation">.</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="第三方使用"><a href="#第三方使用" class="header-anchor">#</a> 第三方使用</h3> <blockquote><p>使用第三方公司封装的插件(SDK)</p></blockquote> <p>推荐2个比较常用的即时通信服务平台</p> <ul><li>环信</li> <li>容联云</li></ul> <p>具体使用过程, 根据文档, 集成到自己项目中</p> <h3 id="小结-4"><a href="#小结-4" class="header-anchor">#</a> 小结</h3> <ol><li>可以不用原生WebSocket干, 使用一些包例如, socket.io包</li> <li>前端要注意使用client名字的js文件</li> <li>也可以使用第三方服务, 快速集成功能</li></ol> <h2 id="_5-小思同学-页面准备"><a href="#_5-小思同学-页面准备" class="header-anchor">#</a> 5.小思同学_页面准备</h2> <h3 id="目标-5"><a href="#目标-5" class="header-anchor">#</a> 目标</h3> <ul><li><p>创建小思同学页面和标签</p></li> <li><p>配置路由</p> <p><img src="images/image-20210711143139575.png" alt="image-20210711143139575"></p></li></ul> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <ol><li><p>views/Chat/index.vue - 创建页面</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 固定导航 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-nav-bar</span> <span class="token attr-name">fixed</span> <span class="token attr-name">left-arrow</span> <span class="token attr-name">@click-left</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$router.back()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>小思同学<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-nav-bar</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 聊天主体区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 左侧是机器人小思 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-item left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span> <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">round</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img.yzcdn.cn/vant/cat.jpeg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-pao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>这里是别人说的话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

          <span class="token comment">&lt;!-- 右侧是当前用户 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-item right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-pao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>这里是我说的话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span> <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">round</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img.yzcdn.cn/vant/cat.jpeg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 对话区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-container van-hairline--top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-field</span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>说点什么...<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#button</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#999</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Chat'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.container</span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fafafa<span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> 46px 0 50px 0<span class="token punctuation">;</span>
  <span class="token selector">.chat-list</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
    <span class="token selector">.chat-item</span> <span class="token punctuation">{</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token selector">.van-image</span> <span class="token punctuation">{</span>
        <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token selector">.chat-pao</span> <span class="token punctuation">{</span>
        <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span>
        <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
        <span class="token property">min-width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">max-width</span><span class="token punctuation">:</span> 70%<span class="token punctuation">;</span>
        <span class="token property">min-height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
        <span class="token property">line-height</span><span class="token punctuation">:</span> 38px<span class="token punctuation">;</span>
        <span class="token property">border</span><span class="token punctuation">:</span> 0.5px solid #c2d9ea<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
        <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token punctuation">;</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> #e0effb<span class="token punctuation">;</span>
        <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
        <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
        <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>
          <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
          <span class="token property">width</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
          <span class="token property">height</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
          <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
          <span class="token property">top</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
          <span class="token property">border-top</span><span class="token punctuation">:</span> 0.5px solid #c2d9ea<span class="token punctuation">;</span>
          <span class="token property">border-right</span><span class="token punctuation">:</span> 0.5px solid #c2d9ea<span class="token punctuation">;</span>
          <span class="token property">background</span><span class="token punctuation">:</span> #e0effb<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.chat-item.right</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
  <span class="token selector">.chat-pao</span> <span class="token punctuation">{</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">right</span><span class="token punctuation">:</span> -6px<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.chat-item.left</span> <span class="token punctuation">{</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
  <span class="token selector">.chat-pao</span> <span class="token punctuation">{</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
    <span class="token property">margin-right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>
      <span class="token property">left</span><span class="token punctuation">:</span> -5px<span class="token punctuation">;</span>
      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-135deg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.reply-container</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 9999<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></li> <li><p>配置路由</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Chat <span class="token keyword">from</span> <span class="token string">'@/views/Chat'</span>

<span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/chat'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">component</span><span class="token operator">:</span> Chat
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>点击van-cell单元格跳转页面</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-cell</span> <span class="token attr-name">icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-o<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>小思同学<span class="token punctuation">&quot;</span></span> <span class="token attr-name">is-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/chat<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></li></ol> <h3 id="小结-5"><a href="#小结-5" class="header-anchor">#</a> 小结</h3> <ol><li>van-cell有to属性也能跳转路由</li></ol> <h2 id="_6-小思同学-数据获取和渲染"><a href="#_6-小思同学-数据获取和渲染" class="header-anchor">#</a> 6.小思同学_数据获取和渲染</h2> <h3 id="目标-6"><a href="#目标-6" class="header-anchor">#</a> 目标</h3> <ul><li>铺设小思同学页面</li> <li>先把固定数据铺设上去</li></ul> <h3 id="步骤-2"><a href="#步骤-2" class="header-anchor">#</a> 步骤</h3> <ol><li><p>先在本地渲染数组 - 准备数组并循环渲染到标签上</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Chat'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">word</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 输入框的内容</span>
      <span class="token comment">// 所有的聊天消息</span>
      <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 只根据 name 属性，即可判断出这个消息应该渲染到左侧还是右侧</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xs'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hi，你好！我是小思'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'me'</span><span class="token punctuation">,</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'我是编程小王子'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>把数据循环到标签上, 注意判断数据是哪一边的, 给输入框绑定v-model</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 固定导航 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-nav-bar</span> <span class="token attr-name">fixed</span> <span class="token attr-name">left-arrow</span> <span class="token attr-name">@click-left</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$router.back()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>小思同学<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-nav-bar</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 聊天主体区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>obj, index in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token comment">&lt;!-- 左侧是机器人小思 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-item left<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>obj.name === 'xs'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span> <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">round</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img.yzcdn.cn/vant/cat.jpeg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-pao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ obj.msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

          <span class="token comment">&lt;!-- 右侧是当前用户 --&gt;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-item right<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>obj.name === 'me'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chat-pao<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ obj.msg }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-image</span> <span class="token attr-name">fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span> <span class="token attr-name">round</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://img.yzcdn.cn/vant/cat.jpeg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 对话区域 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reply-container van-hairline--top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>van-field</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>word<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>说点什么...<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">#button</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span>12px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span>#999</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>van-field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <h3 id="小结-6"><a href="#小结-6" class="header-anchor">#</a> 小结</h3> <ol><li>如何区别消息是谁的?
<ul><li>根据消息对象里name字段的值, 决定用哪一边div承载消息</li></ul></li></ol> <h2 id="_7-小思同学-websocket使用"><a href="#_7-小思同学-websocket使用" class="header-anchor">#</a> 7.小思同学_webSocket使用</h2> <h3 id="目标-7"><a href="#目标-7" class="header-anchor">#</a> 目标</h3> <ul><li><p>继承webSocket, 和后台建立通道</p></li> <li><p>完成效果</p> <p><img src="images/image-20210714110301590.png" alt="image-20210714110301590"></p></li></ul> <h3 id="步骤-3"><a href="#步骤-3" class="header-anchor">#</a> 步骤</h3> <ol><li><p>安装客户端socket的包(支持websocket) - 内部对websocket进行了封装</p> <div class="language-js extra-class"><pre class="language-js"><code>yarn add socket<span class="token punctuation">.</span>io<span class="token operator">-</span>client@<span class="token number">4.0</span><span class="token number">.0</span>
</code></pre></div></li> <li><p>在Chat/index.vue引入包</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入 socket.io-client 包</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> io <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'socket.io-client'</span>

<span class="token comment">// 定义变量，存储 websocket 实例</span>
<span class="token keyword">let</span> socket <span class="token operator">=</span> <span class="token keyword">null</span>
</code></pre></div></li> <li><p>创建socket服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    
    <span class="token comment">// 创建客户端 websocket 的实例</span>
    socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">'http://toutiao.itheima.net'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">transports</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'websocket'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>监听是否连接成功</p> <blockquote><p>只有连接内置事件执行了, 才能进行后续操作</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 建立连接的事件</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'与服务器建立了连接'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在组件销毁前, 关闭服务</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 组件被销毁之前，清空 sock 对象</span>
<span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 关闭连接</span>
  socket<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 销毁 websocket 实例对象</span>
  socket <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>在created监听socket的消息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// 接收到消息的事件</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 把服务器发送过来的消息，存储到 list 数组中</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xs'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> data<span class="token punctuation">.</span>msg
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>在 send事件中, 把服务器发来的数据装到数组里</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">sendFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断内容是否为空</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token comment">// 添加聊天消息到 list 列表中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'me'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>客户端调用 <code>socket.emit('message', 消息内容)</code> 方法把消息发送给 websocket 服务器：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 向服务端发送消息</span>
<span class="token function">sendFn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断内容是否为空</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">)</span> <span class="token keyword">return</span>

    <span class="token comment">// 添加聊天消息到 list 列表中</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'me'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 把消息发送给 websocket 服务器</span>
    socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>word<span class="token punctuation">,</span>
        <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 清空文本框的内容</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token operator">=</span> <span class="token string">''</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="小结-7"><a href="#小结-7" class="header-anchor">#</a> 小结</h3> <ol><li><p>vuecli项目中下载socket.io包</p></li> <li><p>建立和服务器的socket连接</p> <blockquote><p>要到连接地址和参数等注意事项</p></blockquote></li> <li><p>与后台协商好, 发送消息和接收消息的事件名, 以及数据格式</p></li></ol> <h2 id="_8-小思同学-滚动到底部"><a href="#_8-小思同学-滚动到底部" class="header-anchor">#</a> 8.小思同学_滚动到底部</h2> <h3 id="目标-8"><a href="#目标-8" class="header-anchor">#</a> 目标</h3> <ul><li><p>发消息和收消息, 立刻滚动到底部</p> <p><img src="images/%E6%9C%BA%E5%99%A8%E4%BA%BA.gif" alt="机器人"></p></li></ul> <h3 id="步骤-4"><a href="#步骤-4" class="header-anchor">#</a> 步骤</h3> <ol><li><p>定义滚动到底部的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 滚动到页面底部</span>
<span class="token function">scrollToBottom</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取到所有的聊天 Item 项</span>
    <span class="token keyword">const</span> chatItem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.chat-item'</span><span class="token punctuation">)</span>
    <span class="token comment">// 获取到最后一项对应的 DOM 元素</span>
    <span class="token keyword">const</span> lastItem <span class="token operator">=</span> chatItem<span class="token punctuation">[</span>chatItem<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// 调用 scrollIntoView() 方法，显示这个元素</span>
    lastItem<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">behavior</span><span class="token operator">:</span> <span class="token string">'smooth'</span> <span class="token comment">// 动画平滑</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在发布消息 / 接收到消息的时候, 调用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="小结-8"><a href="#小结-8" class="header-anchor">#</a> 小结</h3> <ol><li>获取原生DOM, 调用scrollIntoView方法, 让标签滚到可视窗口</li> <li>如果下面没有更多内容了, 是不一定会滚到头的</li></ol> <h2 id="_9-小思同学-存储用户头像-上午结束"><a href="#_9-小思同学-存储用户头像-上午结束" class="header-anchor">#</a> 9.小思同学_存储用户头像(上午结束)</h2> <h3 id="目标-9"><a href="#目标-9" class="header-anchor">#</a> 目标</h3> <ul><li>把我的信息保存到vuex中</li> <li>把信息持久化存储(否则聊天界面刷新头像就没了)</li></ul> <h3 id="步骤-5"><a href="#步骤-5" class="header-anchor">#</a> 步骤</h3> <ol><li><p>在vuex中定义变量保存信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Vuex <span class="token keyword">from</span> <span class="token string">'vuex'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Vuex<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 用户基本资料(默认从本地取)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">setUser</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> userObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>user <span class="token operator">=</span> userObj
      localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>userObj<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></li> <li><p>在User/index.vue中, 获取后保存起来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'setToken'</span><span class="token punctuation">,</span> <span class="token string">'setUser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">userInfoAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>user <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>既然存储到vuex中, 我的页面也使用</p> <blockquote><p>逻辑页面里网络请求 =&gt; 存储vuex和localStorage中 =&gt; 映射回到逻辑页面里使用</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapMutations <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// user: {} // 用户对象</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">userInfoAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token comment">// this.user = res.data.data</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>去小思同学页面使用vuex中的值, 使用头像</p> <blockquote><p>定义getters, 直接拿到user里的头像</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">userPhoto</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> state<span class="token punctuation">.</span>user<span class="token punctuation">.</span>photo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在逻辑页面映射过来使用即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapGetters <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'userPhoto'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="小结-9"><a href="#小结-9" class="header-anchor">#</a> 小结</h3> <ol><li>跨页面用值, 其实可以直接父传子</li> <li>但是为了后面跨页面使用, 做铺垫, 保存到vuex中</li> <li>如果刷新也要使用的值, 要做本地持久化存储</li></ol> <h2 id="_10-优化-路由-懒加载"><a href="#_10-优化-路由-懒加载" class="header-anchor">#</a> 10.优化_路由-懒加载</h2> <h3 id="目标-10"><a href="#目标-10" class="header-anchor">#</a> 目标</h3> <ul><li>为何使用路由懒加载</li> <li>什么是路由懒加载</li></ul> <h3 id="步骤-6"><a href="#步骤-6" class="header-anchor">#</a> 步骤</h3> <ol><li><p>运行时, network里禁用缓存, 观察app.js大小</p></li> <li><p>路由懒加载 - 查看文档: https://router.vuejs.org/zh/guide/advanced/lazy-loading.html</p></li> <li><p>使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">component</span><span class="token operator">:</span> Login
<span class="token comment">// 改成这个写法</span>
<span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/Login.vue'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>再次运行后观察app.js的大小</p></li></ol> <blockquote><p>路由拦截器, 可以让页面不上来都被引入到webpack里一起打包插入到浏览器运行</p> <p>等待使用时, 再去循环对应页面组件</p></blockquote> <h3 id="小结-10"><a href="#小结-10" class="header-anchor">#</a> 小结</h3> <ol><li>为何使用路由拦截器?
<ul><li>为了让首页渲染更快</li></ul></li> <li>什么是路由懒加载?
<ul><li>路由规则匹配后, 再加载对应js代码</li></ul></li></ol> <h2 id="_11-优化-路由-全局守卫"><a href="#_11-优化-路由-全局守卫" class="header-anchor">#</a> 11.优化_路由-全局守卫</h2> <h3 id="目标-11"><a href="#目标-11" class="header-anchor">#</a> 目标</h3> <ul><li>登录成功时, 不允许切换路径进入登录页面</li></ul> <h3 id="步骤-7"><a href="#步骤-7" class="header-anchor">#</a> 步骤</h3> <p>方法1: 全局前置守卫判断</p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 有token, 不能去登录页</span>
  <span class="token comment">// 无token, 需要用户&quot;权限&quot;的才需要去登录页</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>token<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 证明有token-已经登录了</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 阻止跳转原地呆着</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>方法2: 路由独享守卫</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: &quot;Login&quot; */</span> <span class="token string">'@/views/Login'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">beforeEnter</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>token<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// vuex里有token(代表登录过, 但是一定要注意过期和主动退出要先清除vuex和本地的token, 让其跳转登录页)</span>
        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="小结-11"><a href="#小结-11" class="header-anchor">#</a> 小结</h3> <ol><li>路由守卫有很多种, 具体查阅文档</li> <li>重点多看看路由执行的过程和注意事项</li></ol> <h2 id="_12-token续签"><a href="#_12-token续签" class="header-anchor">#</a> 12.token续签</h2> <h3 id="目标-12"><a href="#目标-12" class="header-anchor">#</a> 目标</h3> <ul><li>token过期401, 强制跳转到登录页, 清空本地和store中的token数据</li> <li>token过期401, 用refresh_token无感知的刷新一个新的token回来
<ul><li>替换旧的token的同时, 继续上次未完成的请求. 用户体验好</li></ul></li></ul> <h3 id="步骤-8"><a href="#步骤-8" class="header-anchor">#</a> 步骤</h3> <ol><li><p>定义刷新token的接口方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用户 - 更新token</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">refreshTokenAPI</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/v1_0/authorizations'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Authorization</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>refresh_token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>在响应拦截器401处, 调用重新请求token的接口, 然后同步给vuex和本地</p> <div class="language-js extra-class"><pre class="language-js"><code>axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  <span class="token keyword">return</span> response
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 身份过期</span>
    <span class="token comment">// token续签方式1:</span>
    <span class="token comment">// store.commit('setToken', '')</span>
    <span class="token comment">// router.push({ path: '/login' })</span>

    <span class="token comment">// token续签方式2: refreshToken(用户无感知)</span>
    store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setToken'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">refreshTokenAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setToken'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
    <span class="token comment">// 再调用一次未完成的请求啊(用户无感知)</span>
    <span class="token comment">// error.config 就是上一次axios请求的配置对象</span>
    <span class="token comment">// console.dir(error.config)</span>
    <span class="token comment">// 把新的token赋予到下一次axios请求的请求头中</span>
    error<span class="token punctuation">.</span>config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>Authorization <span class="token operator">=</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>token
    <span class="token comment">// return到await的地方</span>
    <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>config<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h3 id="小结-12"><a href="#小结-12" class="header-anchor">#</a> 小结</h3> <ul><li>token过期, 强制跳转登录</li> <li>token过期, 无感知刷新token, 重新再发起一次请求</li></ul> <h2 id="_13-api接口分文件"><a href="#_13-api接口分文件" class="header-anchor">#</a> 13.api接口分文件</h2> <h3 id="目标-13"><a href="#目标-13" class="header-anchor">#</a> 目标</h3> <ul><li>把api文件打散</li></ul> <h3 id="步骤-9"><a href="#步骤-9" class="header-anchor">#</a> 步骤</h3> <ul><li>原因: 一个api/index.js, 有几百行代码, 不便于管理</li> <li>解决: 分散到多个js文件里, 再引入回到统一导出
<ul><li>分散的js文件名, 尽量和页面模块同名, 方便查找</li></ul></li></ul> <p>问题1: 分文件后, 逻辑页面里都是从api/index.js导出的, 难道我们要去改逻辑代码?</p> <p>解决: 在api/index.js - 中  export * from '分散的文件'  (模块重定向)</p> <p>意思: 在api/index.js 作为入口, 从别的地方把接口倒回来同时导出给外面</p> <blockquote><p>export 文档: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/export</p></blockquote> <p>注意; 包括reports.js文件也从统一出口导出, 去修改src/components/ArticleItem引数据位置</p> <h3 id="结果"><a href="#结果" class="header-anchor">#</a> 结果</h3> <p>api/index.js如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./reports'</span> <span class="token comment">// 反馈列表数据</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./ArticleDetail'</span> <span class="token comment">// 文章详情相关</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./Home'</span> <span class="token comment">// 首页(频道)相关, 首页文章列表</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./Login'</span> <span class="token comment">// 登录相关</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./Search'</span> <span class="token comment">// 搜索相关</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./User'</span> <span class="token operator">/</span> 用户相关
</code></pre></div><h3 id="小结-13"><a href="#小结-13" class="header-anchor">#</a> 小结</h3> <ol><li>分散以后, 尽量不改变原有代码</li> <li>export * from '模块' (导入所有并再以相同方式导出)</li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_1-http协议复习" class="sidebar-link reco-side-_1-http协议复习" data-v-b57cc07c>1.http协议复习</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标" class="sidebar-link reco-side-目标" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#讲解" class="sidebar-link reco-side-讲解" data-v-b57cc07c>讲解</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#缺点" class="sidebar-link reco-side-缺点" data-v-b57cc07c>缺点</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结" class="sidebar-link reco-side-小结" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_2-即时通信介绍" class="sidebar-link reco-side-_2-即时通信介绍" data-v-b57cc07c>2.即时通信介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-2" class="sidebar-link reco-side-目标-2" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#讲解-2" class="sidebar-link reco-side-讲解-2" data-v-b57cc07c>讲解</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#使用场景" class="sidebar-link reco-side-使用场景" data-v-b57cc07c>使用场景</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-2" class="sidebar-link reco-side-小结-2" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_3-websocket使用" class="sidebar-link reco-side-_3-websocket使用" data-v-b57cc07c>3.webSocket使用</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-3" class="sidebar-link reco-side-目标-3" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#概念" class="sidebar-link reco-side-概念" data-v-b57cc07c>概念</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#体验-前端代码" class="sidebar-link reco-side-体验-前端代码" data-v-b57cc07c>体验 - 前端代码</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-3" class="sidebar-link reco-side-小结-3" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_4-socket-io包使用" class="sidebar-link reco-side-_4-socket-io包使用" data-v-b57cc07c>4.socket.io包使用</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-4" class="sidebar-link reco-side-目标-4" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#后端代码" class="sidebar-link reco-side-后端代码" data-v-b57cc07c>后端代码</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#前端代码" class="sidebar-link reco-side-前端代码" data-v-b57cc07c>前端代码</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#第三方使用" class="sidebar-link reco-side-第三方使用" data-v-b57cc07c>第三方使用</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-4" class="sidebar-link reco-side-小结-4" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_5-小思同学-页面准备" class="sidebar-link reco-side-_5-小思同学-页面准备" data-v-b57cc07c>5.小思同学_页面准备</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-5" class="sidebar-link reco-side-目标-5" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤" class="sidebar-link reco-side-步骤" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-5" class="sidebar-link reco-side-小结-5" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_6-小思同学-数据获取和渲染" class="sidebar-link reco-side-_6-小思同学-数据获取和渲染" data-v-b57cc07c>6.小思同学_数据获取和渲染</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-6" class="sidebar-link reco-side-目标-6" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-2" class="sidebar-link reco-side-步骤-2" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-6" class="sidebar-link reco-side-小结-6" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_7-小思同学-websocket使用" class="sidebar-link reco-side-_7-小思同学-websocket使用" data-v-b57cc07c>7.小思同学_webSocket使用</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-7" class="sidebar-link reco-side-目标-7" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-3" class="sidebar-link reco-side-步骤-3" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-7" class="sidebar-link reco-side-小结-7" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_8-小思同学-滚动到底部" class="sidebar-link reco-side-_8-小思同学-滚动到底部" data-v-b57cc07c>8.小思同学_滚动到底部</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-8" class="sidebar-link reco-side-目标-8" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-4" class="sidebar-link reco-side-步骤-4" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-8" class="sidebar-link reco-side-小结-8" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_9-小思同学-存储用户头像-上午结束" class="sidebar-link reco-side-_9-小思同学-存储用户头像-上午结束" data-v-b57cc07c>9.小思同学_存储用户头像(上午结束)</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-9" class="sidebar-link reco-side-目标-9" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-5" class="sidebar-link reco-side-步骤-5" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-9" class="sidebar-link reco-side-小结-9" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_10-优化-路由-懒加载" class="sidebar-link reco-side-_10-优化-路由-懒加载" data-v-b57cc07c>10.优化_路由-懒加载</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-10" class="sidebar-link reco-side-目标-10" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-6" class="sidebar-link reco-side-步骤-6" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-10" class="sidebar-link reco-side-小结-10" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_11-优化-路由-全局守卫" class="sidebar-link reco-side-_11-优化-路由-全局守卫" data-v-b57cc07c>11.优化_路由-全局守卫</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-11" class="sidebar-link reco-side-目标-11" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-7" class="sidebar-link reco-side-步骤-7" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-11" class="sidebar-link reco-side-小结-11" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_12-token续签" class="sidebar-link reco-side-_12-token续签" data-v-b57cc07c>12.token续签</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-12" class="sidebar-link reco-side-目标-12" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-8" class="sidebar-link reco-side-步骤-8" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-12" class="sidebar-link reco-side-小结-12" data-v-b57cc07c>小结</a></li><li class="level-2" data-v-b57cc07c><a href="/hmtt/Day06.html#_13-api接口分文件" class="sidebar-link reco-side-_13-api接口分文件" data-v-b57cc07c>13.api接口分文件</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#目标-13" class="sidebar-link reco-side-目标-13" data-v-b57cc07c>目标</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#步骤-9" class="sidebar-link reco-side-步骤-9" data-v-b57cc07c>步骤</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#结果" class="sidebar-link reco-side-结果" data-v-b57cc07c>结果</a></li><li class="level-3" data-v-b57cc07c><a href="/hmtt/Day06.html#小结-13" class="sidebar-link reco-side-小结-13" data-v-b57cc07c>小结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.e0cc1cb1.js" defer></script><script src="/assets/js/3.9eb4373a.js" defer></script><script src="/assets/js/1.592f9f83.js" defer></script><script src="/assets/js/15.fd252bbc.js" defer></script>
  </body>
</html>
